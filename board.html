<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Tabl√≥n</title>
<link rel="icon" href="favicon.png">
<link rel="stylesheet" href="./css/4chan.css">
</head>

<body>

<div id="top-gradient"></div>

<div id="main">

<h2 id="board-title"></h2>

<div id="reply-box">
  <h3>Publica algo</h3>
  <input type="file" id="threadImage">
  <textarea id="threadText"></textarea>
  <button id="postThread">Publicar</button>
</div>

<div id="threads"></div>

</div>

<script type="module">
import { supabase } from "./js/supabase.js"

const params = new URLSearchParams(window.location.search)
const board = params.get("board")

document.getElementById("board-title").textContent = "/" + board + "/"

const threadsDiv = document.getElementById("threads")

async function loadThreads() {
  const { data, error } = await supabase
    .from("threads")
    .select("*")
    .eq("board_slug", board)
    .order("last_bump", { ascending: false })

  threadsDiv.innerHTML = ""

  data.forEach(t => {
    const div = document.createElement("div")
    div.className = "post"

    div.innerHTML = `
      <div class="post-header">
        <span>No.${t.id}</span>
        <a href="thread.html?id=${t.id}">[Open]</a>
      </div>
      <div>${t.content || ""}</div>
    `

    threadsDiv.appendChild(div)
  })
}

document.getElementById("postThread").onclick = async () => {
  const content = document.getElementById("threadText").value

  await supabase.from("threads").insert([{
    board_slug: board,
    content,
    last_bump: new Date().toISOString()
  }])

  loadThreads()
}

loadThreads()
</script>

</body>
</html>
